{% comment %} {{ 'style-countdown-timer.css' | asset_url | stylesheet_tag }} {% endcomment %}


<style>
  .countdown-timer {
      background: {{ section.settings.background }};
  }

  .countdown-timer__message p,
  .countdown-timer__message a,
  .countdown-timer__counter p {
     color: {{ section.settings.color }};
  }
  
</style>


{% if section.settings.active_countdown == false %}
  <style>
    section.countdown-timer {
      display: none;
    }
  </style>
{% endif %}

<div class="countdown-timer__container">
  <div class="countdown-timer__message">
    {% if section.settings.message != blank %}
      <p>{{ section.settings.message }}</p>
    {% endif %}

    {% if section.settings.link != blank %}
      <a href="{{ section.settings.link }}">{{ section.settings.button }}</a>
    {% endif %}
  </div>

  <div class="countdown-timer__counter">
    {% if section.settings.text_counter != blank %}
      <p>{{ section.settings.text_counter }}</p>
    {% endif %}
    
    <p id="countdownTimer"></p>
  </div>
</div>

<script>
  // Set the date we're counting down to
  var countDownDate = new Date("{{ section.settings.deadline }}").getTime();
  
  // Update the count down every 1 second
  var x = setInterval(function() {
  
    // Get today's date and time
    var now = new Date().getTime();
      
    // Find the distance between now and the count down date
    var distance = countDownDate - now;
      
    // Time calculations for days, hours, minutes and seconds
    var days = Math.floor(distance / (1000 * 60 * 60 * 24)).toLocaleString('en-US', {minimumIntegerDigits: 2,useGrouping: false});
    var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)).toLocaleString('en-US', {minimumIntegerDigits: 2,useGrouping: false});
    var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60)).toLocaleString('en-US', {minimumIntegerDigits: 2,useGrouping: false});
    var seconds = Math.floor((distance % (1000 * 60)) / 1000).toLocaleString('en-US', {minimumIntegerDigits: 2,useGrouping: false});
      
    // Output the result in an element with id="demo"
    if (days > 0 && hours >= 0 && minutes >= 0 && seconds >= 0){
    
      // Days : Hours : Minutes : Second
      document.getElementById("countdownTimer").innerHTML = days + " days " + hours + " hrs " + minutes + " min " + seconds + " sec ";
      
    } else if(days == 0 && hours > 0 && minutes >= 0 && seconds >= 0) {
    
      // Hours : Minutes : Second
      document.getElementById("countdownTimer").innerHTML = hours + " hrs " + minutes + " min " + seconds + " sec ";
      
    } else if(days == 0 && hours == 0 && minutes > 0 && seconds >= 0) {
    
      // Minutes : Second
      document.getElementById("countdownTimer").innerHTML = minutes + " min " + seconds + " sec ";
      
    } else if(days == 0 && hours == 0 && minutes == 0 && seconds >= 0) {
    
      // Second
      document.getElementById("countdownTimer").innerHTML = seconds + " sec ";
      
    } else if(distance < 0) {
    
    	// Expired
    	document.getElementById("countdownTimer").innerHTML = "Expired";
        $('section.countdown-timer').hide();
      
    };
  
  }, 1000);
</script>

{% schema %}
  {
    "name": "Countdown Timer",
    "tag": "section",
    "class": "countdown-timer",
    "settings": [
      {
        "type": "checkbox",
        "id": "active_countdown",
        "label": "Show countdown",
        "default": false
      },
      {
          "type": "color",
          "id": "background",
          "label": "Background",
          "default": "#000000" 
      },
      {
          "type": "color",
          "id": "color",
          "label": "Font Color",
          "default": "#ffffff" 
      },
      {
        "type": "text",
        "id": "deadline",
        "label": "Deadline",
        "info": "Month DD, YYYY HH:MM:SS",
        "default": "December 31, 2030 23:59:59"
      },
      {
        "type": "textarea",
        "id": "message",
        "label": "Message",
        "default": "Your special offer: get 15% off your first order, sitewide."
      },
      {
        "type": "url",
        "id": "link",
        "label": "URL Link"
      },
      {
        "type": "text",
        "id": "button",
        "label": "Text Link",
        "default": "Shop now"
      },
      {
        "type": "text",
        "id": "text_counter",
        "label": "Text Timer",
        "default": "Offer end in"
      }
    ]
  }
{% endschema %}

{% stylesheet %}
{% endstylesheet %}

{% javascript %}
{% endjavascript %}